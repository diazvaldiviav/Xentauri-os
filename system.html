<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis System Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .status-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* Main Architecture Diagram */
        .architecture {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }

        .component {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            min-width: 280px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .component:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .component.ios {
            border-color: #007AFF;
            box-shadow: 0 0 30px rgba(0, 122, 255, 0.2);
        }

        .component.cloud {
            border-color: #7b2cbf;
            box-shadow: 0 0 30px rgba(123, 44, 191, 0.2);
            min-width: 400px;
        }

        .component.pi {
            border-color: #10b981;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.2);
        }

        .component-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .component-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .component-subtitle {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .component-features {
            list-style: none;
            font-size: 0.85rem;
        }

        .component-features li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .component-features li:last-child {
            border-bottom: none;
        }

        .check {
            color: #10b981;
        }

        .pending {
            color: #f59e0b;
        }

        /* Connection Arrows */
        .arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
        }

        .arrow-line {
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #007AFF, #7b2cbf);
            position: relative;
        }

        .arrow-line::after {
            content: '‚ñ∂';
            position: absolute;
            right: -10px;
            top: -8px;
            color: #7b2cbf;
        }

        .arrow-label {
            font-size: 0.75rem;
            margin-top: 5px;
            text-align: center;
        }

        .arrow.bidirectional .arrow-line::before {
            content: '‚óÄ';
            position: absolute;
            left: -10px;
            top: -8px;
            color: #007AFF;
        }

        /* Flow Diagrams */
        .section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Flow Chart */
        .flow-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 30px;
            overflow-x: auto;
        }

        .flow {
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: max-content;
            padding: 10px 0;
        }

        .flow-step {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px 20px;
            min-width: 150px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .flow-step.start {
            background: linear-gradient(135deg, #007AFF, #0056b3);
            border: none;
        }

        .flow-step.end {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
        }

        .flow-step.process {
            border-color: #7b2cbf;
        }

        .flow-step.decision {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: none;
            transform: rotate(0deg);
        }

        .flow-step-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .flow-step-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .flow-arrow {
            color: #666;
            font-size: 1.5rem;
        }

        /* API Endpoints Table */
        .endpoints-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .endpoint-group {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
        }

        .endpoint-group-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .endpoint {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
        }

        .method {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 55px;
            text-align: center;
        }

        .method.get { background: #10b981; }
        .method.post { background: #3b82f6; }
        .method.patch { background: #f59e0b; }
        .method.delete { background: #ef4444; }
        .method.ws { background: #8b5cf6; }

        .endpoint-path {
            flex: 1;
        }

        .endpoint-auth {
            font-size: 0.7rem;
            color: #888;
        }

        /* Data Models */
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .model-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #7b2cbf;
        }

        .model-name {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #7b2cbf;
        }

        .model-fields {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
        }

        .model-field {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .field-name {
            color: #00d4ff;
        }

        .field-type {
            color: #888;
        }

        /* Services */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .service-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 20px;
        }

        .service-name {
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-icon {
            font-size: 1.5rem;
        }

        .service-desc {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .service-methods {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
        }

        .service-method {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            border-left: 3px solid #10b981;
        }

        /* WebSocket Flow */
        .ws-flow {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 25px;
        }

        .ws-participants {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .ws-participant {
            text-align: center;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .ws-messages {
            position: relative;
            padding: 20px 0;
        }

        .ws-message {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.85rem;
        }

        .ws-message.to-right {
            justify-content: flex-start;
        }

        .ws-message.to-left {
            justify-content: flex-end;
        }

        .ws-message-content {
            background: rgba(255, 255, 255, 0.08);
            padding: 10px 15px;
            border-radius: 8px;
            max-width: 60%;
        }

        .ws-message-arrow {
            margin: 0 15px;
            color: #8b5cf6;
        }

        /* Stats */
        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .architecture {
                flex-direction: column;
            }
            
            .arrow {
                transform: rotate(90deg);
            }

            .component {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>ü§ñ Jarvis System Architecture</h1>
    <p class="subtitle">Intelligent Screen Control System <span class="status-badge">Sprint 3.9.1 Complete</span></p>

    <!-- Main Architecture -->
    <div class="architecture">
        <div class="component ios">
            <div class="component-icon">üì±</div>
            <div class="component-title">Jarvis Remote</div>
            <div class="component-subtitle">iOS App (Swift/SwiftUI)</div>
            <ul class="component-features">
                <li><span class="pending">‚è≥</span> Voice command capture</li>
                <li><span class="pending">‚è≥</span> Text command input</li>
                <li><span class="pending">‚è≥</span> Device list & selection</li>
                <li><span class="pending">‚è≥</span> Real-time status display</li>
                <li><span class="pending">‚è≥</span> User authentication</li>
            </ul>
        </div>

        <div class="arrow bidirectional">
            <div class="arrow-line"></div>
            <div class="arrow-label">REST API<br>HTTPS/JSON</div>
        </div>

        <div class="component cloud">
            <div class="component-icon">‚òÅÔ∏è</div>
            <div class="component-title">Jarvis Cloud Core</div>
            <div class="component-subtitle">FastAPI Backend (Python)</div>
            <ul class="component-features">
                <li><span class="check">‚úì</span> User authentication (JWT)</li>
                <li><span class="check">‚úì</span> Device management (CRUD)</li>
                <li><span class="check">‚úì</span> Pairing code service</li>
                <li><span class="check">‚úì</span> WebSocket connection hub</li>
                <li><span class="check">‚úì</span> Command routing</li>
                <li><span class="check">‚úì</span> PostgreSQL database</li>
                <li><span class="check">‚úì</span> AI Router (Gemini orchestrator)</li>
                <li><span class="check">‚úì</span> Intent Parser (NLU)</li>
                <li><span class="check">‚úì</span> Multi-model routing (GPT/Claude)</li>
                <li><span class="check">‚úì</span> Google OAuth + Calendar</li>
                <li><span class="check">‚úì</span> UnifiedContext system</li>
                <li><span class="check">‚úì</span> Structured GPT-4o responses</li>
                <li><span class="check">‚úì</span> Smart Calendar Search (LLM)</li>
                <li><span class="check">‚úì</span> Calendar Event Creation</li>
                <li><span class="check">‚úì</span> Calendar Edit & Delete</li>
                <li><span class="check">‚úì</span> 648 tests passing</li>
                <li><span class="pending">‚è≥</span> Fly.io deployment</li>
            </ul>
        </div>

        <div class="arrow bidirectional">
            <div class="arrow-line"></div>
            <div class="arrow-label">WebSocket<br>Real-time</div>
        </div>

        <div class="component pi">
            <div class="component-icon">üçì</div>
            <div class="component-title">Jarvis Stick</div>
            <div class="component-subtitle">Raspberry Pi Agent (Python)</div>
            <ul class="component-features">
                <li><span class="pending">‚è≥</span> WebSocket client</li>
                <li><span class="pending">‚è≥</span> Pairing flow</li>
                <li><span class="pending">‚è≥</span> HDMI-CEC control</li>
                <li><span class="pending">‚è≥</span> IR blaster fallback</li>
                <li><span class="pending">‚è≥</span> Status reporting</li>
            </ul>
        </div>
    </div>

    <!-- Authentication Flow -->
    <div class="section">
        <h2 class="section-title">üîê Authentication Flow</h2>
        <div class="flow-container">
            <div class="flow">
                <div class="flow-step start">
                    <div class="flow-step-title">User</div>
                    <div class="flow-step-desc">Opens app</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">POST /auth/register</div>
                    <div class="flow-step-desc">or /auth/login</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Validate</div>
                    <div class="flow-step-desc">Check credentials</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Generate JWT</div>
                    <div class="flow-step-desc">24h expiration</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step end">
                    <div class="flow-step-title">Token Returned</div>
                    <div class="flow-step-desc">User authenticated</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Pairing Flow -->
    <div class="section">
        <h2 class="section-title">üîó Device Pairing Flow</h2>
        <div class="flow-container">
            <div class="flow">
                <div class="flow-step start">
                    <div class="flow-step-title">iOS App</div>
                    <div class="flow-step-desc">Create device</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">POST /devices</div>
                    <div class="flow-step-desc">name: "Living Room TV"</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Generate Code</div>
                    <div class="flow-step-desc">e.g., "A1B2C3"</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step decision">
                    <div class="flow-step-title">Display Code</div>
                    <div class="flow-step-desc">15 min TTL</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Pi Enters Code</div>
                    <div class="flow-step-desc">User input</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">POST /devices/pair</div>
                    <div class="flow-step-desc">code + agent_id</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step end">
                    <div class="flow-step-title">Paired!</div>
                    <div class="flow-step-desc">Device linked</div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Router Flow (Sprint 3) -->
    <div class="section">
        <h2 class="section-title">üß† AI Router - Intelligent Request Processing</h2>
        <div class="flow-container">
            <div class="flow">
                <div class="flow-step start">
                    <div class="flow-step-title">User Request</div>
                    <div class="flow-step-desc">Natural language</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">POST /intent</div>
                    <div class="flow-step-desc">REST API</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step decision">
                    <div class="flow-step-title">AI Router</div>
                    <div class="flow-step-desc">Gemini analyzes</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Route Decision</div>
                    <div class="flow-step-desc">Simple/Execution/Reasoning</div>
                </div>
            </div>
        </div>
        
        <!-- Three routing paths -->
        <div style="display: flex; justify-content: space-around; margin-top: 30px; flex-wrap: wrap; gap: 20px;">
            <div class="endpoint-group" style="flex: 1; min-width: 280px; border-left: 4px solid #10b981;">
                <div class="endpoint-group-title">‚úì SIMPLE ‚Üí Gemini</div>
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">Device commands, simple Q&A</div>
                <div class="endpoint">
                    <span style="color: #10b981;">Example:</span>
                    <span>"Turn on the living room TV"</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                    ‚Üí Intent Parser ‚Üí Device Mapper ‚Üí WebSocket ‚Üí Execute
                </div>
            </div>
            
            <div class="endpoint-group" style="flex: 1; min-width: 280px; border-left: 4px solid #3b82f6;">
                <div class="endpoint-group-title">‚ö° EXECUTION ‚Üí GPT-4o</div>
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">Code generation, tool usage</div>
                <div class="endpoint">
                    <span style="color: #3b82f6;">Example:</span>
                    <span>"Write a Python script to schedule my TV"</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                    ‚Üí GPT-4o generates code ‚Üí Returns response
                </div>
            </div>
            
            <div class="endpoint-group" style="flex: 1; min-width: 280px; border-left: 4px solid #8b5cf6;">
                <div class="endpoint-group-title">üß† REASONING ‚Üí Claude</div>
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">Analysis, planning, decisions</div>
                <div class="endpoint">
                    <span style="color: #8b5cf6;">Example:</span>
                    <span>"Analyze my device setup for efficiency"</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                    ‚Üí Claude analyzes ‚Üí Returns insights
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Operations Flow (Sprint 3.7-3.9) -->
    <div class="section">
        <h2 class="section-title">üìÖ Calendar Operations Flow (Sprint 3.7-3.9)</h2>
        <div class="flow-container">
            <div class="flow">
                <div class="flow-step start">
                    <div class="flow-step-title">User Request</div>
                    <div class="flow-step-desc">"Edit my dentist appt"</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Intent Parser</div>
                    <div class="flow-step-desc">Detects EDIT intent</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step decision">
                    <div class="flow-step-title">Smart Search</div>
                    <div class="flow-step-desc">LLM semantic match</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">PendingEditService</div>
                    <div class="flow-step-desc">Store for confirmation</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step end">
                    <div class="flow-step-title">Confirm & Execute</div>
                    <div class="flow-step-desc">Google Calendar API</div>
                </div>
            </div>
        </div>
        
        <!-- Three calendar operation paths -->
        <div style="display: flex; justify-content: space-around; margin-top: 30px; flex-wrap: wrap; gap: 20px;">
            <div class="endpoint-group" style="flex: 1; min-width: 280px; border-left: 4px solid #10b981;">
                <div class="endpoint-group-title">‚ûï CREATE Event</div>
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">Natural language event creation</div>
                <div class="endpoint">
                    <span style="color: #10b981;">Example:</span>
                    <span>"Schedule meeting tomorrow at 3pm"</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                    ‚Üí Parse intent ‚Üí Store pending ‚Üí Confirm ‚Üí Create
                </div>
            </div>
            
            <div class="endpoint-group" style="flex: 1; min-width: 280px; border-left: 4px solid #3b82f6;">
                <div class="endpoint-group-title">‚úèÔ∏è EDIT Event</div>
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">Smart search + semantic matching</div>
                <div class="endpoint">
                    <span style="color: #3b82f6;">Example:</span>
                    <span>"Move dentist to 4pm"</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                    ‚Üí Smart search ‚Üí Store changes ‚Üí Confirm ‚Üí Update
                </div>
            </div>
            
            <div class="endpoint-group" style="flex: 1; min-width: 280px; border-left: 4px solid #ef4444;">
                <div class="endpoint-group-title">üóëÔ∏è DELETE Event</div>
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">Find and delete with confirmation</div>
                <div class="endpoint">
                    <span style="color: #ef4444;">Example:</span>
                    <span>"Cancel my gym session"</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                    ‚Üí Smart search ‚Üí Store pending ‚Üí Confirm ‚Üí Delete
                </div>
            </div>
        </div>
    </div>

    <!-- Command Flow -->
    <div class="section">
        <h2 class="section-title">üìÑ Sprint 4.0: Google Docs Intelligence (Planned)</h2>
        <div class="flow-container">
            <div class="flow">
                <div class="flow-step start">
                    <div class="flow-step-title">User Request</div>
                    <div class="flow-step-desc">"What's in my meeting doc?"</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Intent Parser</div>
                    <div class="flow-step-desc">DOC_QUERY intent</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step decision">
                    <div class="flow-step-title">Find Meeting</div>
                    <div class="flow-step-desc">Smart calendar search</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Extract Links</div>
                    <div class="flow-step-desc">Docs from event</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Fetch & Analyze</div>
                    <div class="flow-step-desc">Gemini/Claude</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step end">
                    <div class="flow-step-title">Summary</div>
                    <div class="flow-step-desc">Key points & actions</div>
                </div>
            </div>
        </div>
        
        <!-- Eight sprint phases -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 30px;">
            <div class="endpoint-group" style="border-left: 4px solid #10b981; padding: 15px;">
                <div style="font-weight: 600; color: #10b981; margin-bottom: 8px;">4.0.1 OAuth Scope</div>
                <div style="font-size: 0.85rem; color: #888;">Add documents.readonly scope</div>
            </div>
            <div class="endpoint-group" style="border-left: 4px solid #3b82f6; padding: 15px;">
                <div style="font-weight: 600; color: #3b82f6; margin-bottom: 8px;">4.0.2 Docs Client</div>
                <div style="font-size: 0.85rem; color: #888;">GoogleDocsClient with error handling</div>
            </div>
            <div class="endpoint-group" style="border-left: 4px solid #8b5cf6; padding: 15px;">
                <div style="font-weight: 600; color: #8b5cf6; margin-bottom: 8px;">4.0.3 Calendar Links</div>
                <div style="font-size: 0.85rem; color: #888;">attachments + conferenceData fields</div>
            </div>
            <div class="endpoint-group" style="border-left: 4px solid #f59e0b; padding: 15px;">
                <div style="font-weight: 600; color: #f59e0b; margin-bottom: 8px;">4.0.4 DocIntelligence</div>
                <div style="font-size: 0.85rem; color: #888;">Gemini (&lt;5k) / Claude (complex)</div>
            </div>
            <div class="endpoint-group" style="border-left: 4px solid #ef4444; padding: 15px;">
                <div style="font-weight: 600; color: #ef4444; margin-bottom: 8px;">4.0.5 MeetingLinks</div>
                <div style="font-size: 0.85rem; color: #888;">Calendar as source of truth</div>
            </div>
            <div class="endpoint-group" style="border-left: 4px solid #00d4ff; padding: 15px;">
                <div style="font-weight: 600; color: #00d4ff; margin-bottom: 8px;">4.0.6 DOC_QUERY</div>
                <div style="font-size: 0.85rem; color: #888;">New intent + handler</div>
            </div>
            <div class="endpoint-group" style="border-left: 4px solid #ec4899; padding: 15px;">
                <div style="font-weight: 600; color: #ec4899; margin-bottom: 8px;">4.0.7 Prompts</div>
                <div style="font-size: 0.85rem; color: #888;">Router & parser updates</div>
            </div>
            <div class="endpoint-group" style="border-left: 4px solid #10b981; padding: 15px;">
                <div style="font-weight: 600; color: #10b981; margin-bottom: 8px;">4.0.8 E2E Tests</div>
                <div style="font-size: 0.85rem; color: #888;">WOW demo moment! üéâ</div>
            </div>
        </div>
    </div>

    <!-- Command Flow -->
    <div class="section">
        <h2 class="section-title">‚ö° Command Execution Flow</h2>
        <div class="flow-container">
            <div class="flow">
                <div class="flow-step start">
                    <div class="flow-step-title">User Command</div>
                    <div class="flow-step-desc">"Turn on TV"</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">POST /commands/{id}/power/on</div>
                    <div class="flow-step-desc">REST API</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step decision">
                    <div class="flow-step-title">Device Online?</div>
                    <div class="flow-step-desc">Check WebSocket</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Send via WebSocket</div>
                    <div class="flow-step-desc">{type: "command"}</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Pi Receives</div>
                    <div class="flow-step-desc">Parse command</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step process">
                    <div class="flow-step-title">Execute CEC</div>
                    <div class="flow-step-desc">cec-client</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step end">
                    <div class="flow-step-title">TV Turns On</div>
                    <div class="flow-step-desc">Success!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- WebSocket Communication -->
    <div class="section">
        <h2 class="section-title">üîå WebSocket Communication</h2>
        <div class="ws-flow">
            <div class="ws-participants">
                <div class="ws-participant">
                    <div style="font-size: 2rem;">üçì</div>
                    <div>Raspberry Pi Agent</div>
                </div>
                <div class="ws-participant">
                    <div style="font-size: 2rem;">‚òÅÔ∏è</div>
                    <div>Cloud Server</div>
                </div>
            </div>
            <div class="ws-messages">
                <div class="ws-message to-right">
                    <div class="ws-message-content">
                        <strong>1. Connect</strong><br>
                        ws://server/ws/devices?agent_id=pi-living-room
                    </div>
                    <div class="ws-message-arrow">‚Üí‚Üí‚Üí</div>
                </div>
                <div class="ws-message to-left">
                    <div class="ws-message-arrow">‚Üê‚Üê‚Üê</div>
                    <div class="ws-message-content">
                        <strong>2. Accept</strong><br>
                        Connection established, device marked online
                    </div>
                </div>
                <div class="ws-message to-left">
                    <div class="ws-message-arrow">‚Üê‚Üê‚Üê</div>
                    <div class="ws-message-content">
                        <strong>3. Command</strong><br>
                        {"type": "command", "command_type": "power_on", ...}
                    </div>
                </div>
                <div class="ws-message to-right">
                    <div class="ws-message-content">
                        <strong>4. Acknowledgment</strong><br>
                        {"type": "ack", "status": "success"}
                    </div>
                    <div class="ws-message-arrow">‚Üí‚Üí‚Üí</div>
                </div>
                <div class="ws-message to-right">
                    <div class="ws-message-content">
                        <strong>5. Heartbeat</strong><br>
                        {"type": "ping"} every 30s
                    </div>
                    <div class="ws-message-arrow">‚Üí‚Üí‚Üí</div>
                </div>
            </div>
        </div>
    </div>

    <!-- API Endpoints -->
    <div class="section">
        <h2 class="section-title">üì° API Endpoints</h2>
        <div class="endpoints-grid">
            <div class="endpoint-group">
                <div class="endpoint-group-title">üîê Authentication</div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/auth/register</span>
                    <span class="endpoint-auth">public</span>
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/auth/login</span>
                    <span class="endpoint-auth">public</span>
                </div>
            </div>

            <div class="endpoint-group">
                <div class="endpoint-group-title">üë§ Users</div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/users/me</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
            </div>

            <div class="endpoint-group">
                <div class="endpoint-group-title">üì∫ Devices</div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/devices</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/devices</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/devices/{id}</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method patch">PATCH</span>
                    <span class="endpoint-path">/devices/{id}</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method delete">DEL</span>
                    <span class="endpoint-path">/devices/{id}</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/devices/{id}/pairing-code</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/devices/pair</span>
                    <span class="endpoint-auth">public</span>
                </div>
            </div>

            <div class="endpoint-group">
                <div class="endpoint-group-title">‚ö° Commands</div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/commands/{device_id}</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/commands/{id}/power/on</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/commands/{id}/power/off</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/commands/{id}/status</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method ws">WS</span>
                    <span class="endpoint-path">/ws/devices?agent_id=xxx</span>
                    <span class="endpoint-auth">public</span>
                </div>
            </div>

            <div class="endpoint-group">
                <div class="endpoint-group-title">üß† Intent (AI)</div>
                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/intent</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/intent/stats</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
            </div>

            <div class="endpoint-group">
                <div class="endpoint-group-title">üîó Google OAuth</div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/auth/google/login</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/auth/google/callback</span>
                    <span class="endpoint-auth"></span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/auth/google/status</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
                <div class="endpoint">
                    <span class="method delete">DELETE</span>
                    <span class="endpoint-path">/auth/google</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
            </div>

            <div class="endpoint-group">
                <div class="endpoint-group-title">‚òÅÔ∏è Cloud Content</div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/cloud/calendar</span>
                    <span class="endpoint-auth">üîí token</span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/cloud/calendar/preview</span>
                    <span class="endpoint-auth"></span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/cloud/calendar/status</span>
                    <span class="endpoint-auth">üîí auth</span>
                </div>
            </div>

            <div class="endpoint-group">
                <div class="endpoint-group-title">üñ•Ô∏è Display Simulator</div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/simulator</span>
                    <span class="endpoint-auth"></span>
                </div>
                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/simulator/{device_id}</span>
                    <span class="endpoint-auth"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Models -->
    <div class="section">
        <h2 class="section-title">üóÉÔ∏è Data Models</h2>
        <div class="models-grid">
            <div class="model-card">
                <div class="model-name">User</div>
                <div class="model-fields">
                    <div class="model-field">
                        <span class="field-name">id</span>
                        <span class="field-type">UUID (PK)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">email</span>
                        <span class="field-type">String (unique)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">hashed_password</span>
                        <span class="field-type">String</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">display_name</span>
                        <span class="field-type">String (optional)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">is_active</span>
                        <span class="field-type">Boolean</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">created_at</span>
                        <span class="field-type">DateTime</span>
                    </div>
                </div>
            </div>

            <div class="model-card">
                <div class="model-name">Device</div>
                <div class="model-fields">
                    <div class="model-field">
                        <span class="field-name">id</span>
                        <span class="field-type">UUID (PK)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">user_id</span>
                        <span class="field-type">UUID (FK ‚Üí User)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">name</span>
                        <span class="field-type">String</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">agent_id</span>
                        <span class="field-type">String (optional)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">capabilities</span>
                        <span class="field-type">JSON (optional)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">is_online</span>
                        <span class="field-type">Boolean</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">last_seen</span>
                        <span class="field-type">DateTime (optional)</span>
                    </div>
                </div>
            </div>

            <div class="model-card">
                <div class="model-name">Pairing Code (In-Memory)</div>
                <div class="model-fields">
                    <div class="model-field">
                        <span class="field-name">code</span>
                        <span class="field-type">String (6 chars)</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">device_id</span>
                        <span class="field-type">UUID</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">expires_at</span>
                        <span class="field-type">DateTime (+15 min)</span>
                    </div>
                </div>
            </div>

            <div class="model-card">
                <div class="model-name">WebSocket Connection (In-Memory)</div>
                <div class="model-fields">
                    <div class="model-field">
                        <span class="field-name">device_id</span>
                        <span class="field-type">UUID</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">websocket</span>
                        <span class="field-type">WebSocket</span>
                    </div>
                    <div class="model-field">
                        <span class="field-name">last_seen</span>
                        <span class="field-type">DateTime</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Services -->
    <div class="section">
        <h2 class="section-title">‚öôÔ∏è Services</h2>
        <div class="services-grid">
            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üîë</span>
                    PairingService
                </div>
                <div class="service-desc">Manages device pairing codes with 15-minute TTL</div>
                <div class="service-methods">
                    <div class="service-method">generate_code(device_id) ‚Üí (code, expires_at)</div>
                    <div class="service-method">validate_code(code) ‚Üí device_id | None</div>
                    <div class="service-method">consume_code(code) ‚Üí device_id | None</div>
                    <div class="service-method">cleanup_expired() ‚Üí count</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üîå</span>
                    ConnectionManager
                </div>
                <div class="service-desc">Manages WebSocket connections for Pi agents</div>
                <div class="service-methods">
                    <div class="service-method">connect(device_id, websocket)</div>
                    <div class="service-method">disconnect(device_id)</div>
                    <div class="service-method">is_connected(device_id) ‚Üí bool</div>
                    <div class="service-method">send_to_device(device_id, message) ‚Üí bool</div>
                    <div class="service-method">send_command(device_id, type, params) ‚Üí bool</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">‚ö°</span>
                    CommandService
                </div>
                <div class="service-desc">High-level command API for common TV operations</div>
                <div class="service-methods">
                    <div class="service-method">power_on(device_id) ‚Üí bool</div>
                    <div class="service-method">power_off(device_id) ‚Üí bool</div>
                    <div class="service-method">set_input(device_id, input) ‚Üí bool</div>
                    <div class="service-method">volume_up/down/set(device_id) ‚Üí bool</div>
                    <div class="service-method">mute/unmute(device_id) ‚Üí bool</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üß†</span>
                    AIRouter
                </div>
                <div class="service-desc">Intelligent routing to appropriate AI model</div>
                <div class="service-methods">
                    <div class="service-method">analyze_request(text) ‚Üí RoutingDecision</div>
                    <div class="service-method">process(text, context) ‚Üí AIResponse</div>
                    <div class="service-method">‚Üí SIMPLE: Gemini Intent Parser</div>
                    <div class="service-method">‚Üí EXECUTION: GPT-4o</div>
                    <div class="service-method">‚Üí REASONING: Claude</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üìä</span>
                    AIMonitor (DRY)
                </div>
                <div class="service-desc">Unified logging + metrics in one call</div>
                <div class="service-methods">
                    <div class="service-method">track_request(id, prompt, provider)</div>
                    <div class="service-method">track_response(id, tokens, latency)</div>
                    <div class="service-method">track_routing(id, complexity, target)</div>
                    <div class="service-method">track_error(id, error, stage)</div>
                    <div class="service-method">get_stats() ‚Üí AggregatedMetrics</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üñ•Ô∏è</span>
                    Display Simulator
                </div>
                <div class="service-desc">Browser-based Raspberry Pi display emulator</div>
                <div class="service-methods">
                    <div class="service-method">WebSocket connection (same as real Pi)</div>
                    <div class="service-method">Content display in iframe</div>
                    <div class="service-method">localStorage persistence (survives refresh)</div>
                    <div class="service-method">Keyboard: L=logs, ESC=clear, F=fullscreen</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üîë</span>
                    ContentTokenService
                </div>
                <div class="service-desc">Signed URL tokens for iframe authentication</div>
                <div class="service-methods">
                    <div class="service-method">generate_token(user_id) ‚Üí JWT (5 min)</div>
                    <div class="service-method">validate_token(token) ‚Üí user_id</div>
                    <div class="service-method">Solves iframe header auth problem</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üîç</span>
                    CalendarSearchService
                </div>
                <div class="service-desc">LLM-powered semantic calendar search</div>
                <div class="service-methods">
                    <div class="service-method">smart_search(query, user) ‚Üí SmartSearchResult</div>
                    <div class="service-method">Handles typos, synonyms, translations</div>
                    <div class="service-method">Returns corrected_query for user feedback</div>
                    <div class="service-method">‚Üí "dentist appt" finds "Dentist Appointment"</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">üìÖ</span>
                    PendingEventService
                </div>
                <div class="service-desc">Manages pending calendar event creation</div>
                <div class="service-methods">
                    <div class="service-method">store_pending(user_id, event_data)</div>
                    <div class="service-method">get_pending(user_id) ‚Üí PendingEvent | None</div>
                    <div class="service-method">confirm_pending(user_id) ‚Üí CalendarEvent</div>
                    <div class="service-method">cancel_pending(user_id)</div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="service-icon">‚úèÔ∏è</span>
                    PendingEditService
                </div>
                <div class="service-desc">Manages pending edit/delete operations</div>
                <div class="service-methods">
                    <div class="service-method">store_pending_edit(user_id, events, changes)</div>
                    <div class="service-method">get_pending(user_id) ‚Üí PendingEdit | None</div>
                    <div class="service-method">select_event(user_id, index) ‚Üí MatchingEvent</div>
                    <div class="service-method">confirm_pending(user_id) ‚Üí Success/Error</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div class="stats">
        <div class="stat">
            <div class="stat-value">3.9.1</div>
            <div class="stat-label">Sprints Complete</div>
        </div>
        <div class="stat">
            <div class="stat-value">24</div>
            <div class="stat-label">API Endpoints</div>
        </div>
        <div class="stat">
            <div class="stat-value">3</div>
            <div class="stat-label">AI Models</div>
        </div>
        <div class="stat">
            <div class="stat-value">11</div>
            <div class="stat-label">Core Services</div>
        </div>
        <div class="stat">
            <div class="stat-value">648</div>
            <div class="stat-label">Tests Passing</div>
        </div>
    </div>

    <footer>
        <p>Jarvis System Architecture ‚Ä¢ Sprint 3.9.1 Complete ‚Ä¢ December 17, 2025</p>
        <p style="margin-top: 10px; font-size: 0.9rem;">
            Current: Sprint 4.0 - Calendar + Google Docs Intelligence üìÑ<br>
            Completed: AI Router, Calendar (Display/Search/Create/Edit/Delete), Bug Fixes ‚úÖ
        </p>
    </footer>
</body>
</html>
